1. 异常场景测试(授权中心)

   1) 测试内容：Controller内的异常处理

   ​    预期：异常被处理，返回规定格式的错误信息

   ​    步骤：访问CustomerOauthController的getCliToken方法，但是不带resourceId参数

   ​    结果：异常被处理，返回规定格式的错误信息

   2) Controller外的异常处理(过滤器等)

   ​     预期：异常未被处理，进程未被杀死

   ​     步骤：修改代码，使程序在filter内发生异常

   ​     结果：异常未被处理，程序继续运行

   3) 权限异常(无权限)

   ​     预期：没有访问权限，-10

   ​     步骤：使用normal用户生成的token访问获取密钥

   ​     结果：没有访问权限，-10

2. 权限状态发生变化

   1) 预期：权限状态为1时，正常访问，权限状态为0时，没有访问权限

   ​    步骤：使用xunzhan用户，访问auth_client_server的/test/getRandomPriv3(需要priv3权限)

   ​    结果：权限状态为1时，正常访问，权限状态为0时，没有访问权限

3. 客户端key

   1) 预期：key切换平滑过渡

   ​    步骤：使用xunzhan用户的xunzhan_key1访问token获取，然后修改xunzhan用户的key，增加  xunzhan_key2，待授权中心刷新客户端缓存后(30s)，使用xunzhan_key2再次访问获取token

   ​    结果：key可以平滑切换

   2) 客户端key无效或者为空

   ​     预期：客户端签名错误

   ​     步骤：将xunzhan用户的key设置为空，获取token访问

   ​     结果：客户端签名错误

4. 服务器宕机，重启

   预期：重启后客户端能够正常获取密钥、token等业务

   步骤：启动授权中心，启动auth_client_server访问授权中心获取密钥、token，此时关闭授权中心服务，待auth_client_server刷新密钥、token，发生异常(Connection refused: connect)，但不阻断进程，重启授权中心，auth_client_server可以正常刷新密钥、token

   结果：重启后客户端能够正常获取密钥、token等业务

   授权中心宕机后重启，客户端的密钥或者token刷新需要等待定时任务

5. http请求超时

   1) connecttimeout

   ​    预期：connecttimeout超时异常

   ​    步骤：启动auth_client_server前，设置ClientHttpRequestFactory的ConnectTimeout时间为1毫秒

   ​    结果：未发生connecttimeout异常，正常访问

   2) sockettimeout  

   ​    预期：SocketTimeoutException: Read timed out 但不影响进程

   ​    步骤：启动auth_client_server前，设置ClientHttpRequestFactory的SocketTimeout时间为1毫秒

   ​    结果：发生SocketTimeoutException异常，但不影响进程

   3) 服务端延迟返回

   ​    预期：程序抛出超时异常

   ​    步骤：再说请求的服务端添加代码，延迟服务端的返回超过所设置的超时最大时间，例如：

   ​                for(int i=0;i<Integer.MAX_VALUE;i++){   

   ​			logger.info("授权中心延迟返回{}",i);   

   ​		}

   ​    结果：程序抛出超时异常(Read timed out)

6. token超时验证

   测试内容：token超时

   预期：微服务Token已过期

   步骤：获取token，等待token超时，向授权中心发送请求

   结果：微服务Token已过期

7. 微服务状态发生变化

   预期：客户端ID错误

   步骤：首先获取一个token，然后修改微服务状态，授权中心每分钟刷新一次数据表，待刷新完成使用token访问授权中心

   结果：客户端ID错误

   ​

   ​

